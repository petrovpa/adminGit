			Инструкция по инициализации и обновлении  базы данных под модуля front на платформе SOA
	
	Предварительные условия и требования.

1. Для инициализации базы данных Вам необходимо установить один из поддерживаемых серверов баз данных:
	* MS SQL Server 2000
	* MS SQL Server 2005
	* Oracle 10g

При установке  MS SQL Server 200X убедитесь, что выбран case insensitive collation. 
Это важно! Платформа не поддерживает работу с case sensitive collations.

2. Для инициализации данных Вам необходимо знать пароль администратора БД.

3. В Oracle 10g должна быть создана база данных средствами Database Configuration Assistant

4. Возможно, Вам понадобится JDBC драйвер для Вашей СУБД. Скопируйте его в папку lib

5. Перед обновлением базы данных рекомендуется сделать полный бекап всех данных. 


	
	Порядок действий

Для инициализации базы данных запустите файл dm.bat.

Таблицы и данные модуля могут быть созданы как в базе платформы, так и отдельной базой данных.
Если производится проливка данных модуля на базу платформы, то достаточное единственного запуска dm.bat.
Если данные модуля и платформы находятся в разных базах данных, то необходимо произвести 2 запуска.
По одному для каждой из баз данных (для базы платформы необходимо использовать команду -p)

Формат комадной строки:

	dm.bat [commands] [options]

Скрипт инициализации понимает следующие команды:

	-d или drop - удаляет существующую базу данных 
	ВНИМАНИЕ! Не рекомендуется использовать, если для таблиц платформы используется та же база данных, т.к. приведет к удалению базы платформы.   
	-c или create - создает базу данных и пользователя. Использовать, если для модуля нужно создать отдельную базу 
	-i или init - инициализирует базу данных (создает таблицы, индексы и т.п.)
	-u или update - обновляет структуру БД до текущей версии. 
	-p или platform - указывает, что нужно инициализировать или обновлять только данные таблиц платформы, специфичные для модуля.
	Использовать, если таблицы модуля и платформы развернуты на разных базах данных. 
	-v или validate - проверяет соответствие структуры БД текущей версии. Эта команда действует по умолчанию.
		
Скрипту инициализации необходимо передавать следующие опции:
			
	--driver=<driverClassname> - задает имя класса - JDBC драйвера для доступа к БД (можно не указывать для MS SQL Server или Oracle) 
	--url=<url> - задает JDBC URL для доступа к БД
	--database=<databaseName> - задает имя базы данных для создания, удаления или инициализации	
	--username=<username> - задает имя пользователя, который будет создан и которого следует использовать для соединения с БД 		
	--password=<password> - задает пароль пользователя, по умолчанию: совпадает с именем пользователя
	--admin=<username> - задет имя суперпользователя, у которого есть права на создание баз данных, таблиц и т.п.
	--adminPassword=<password> - задает пароль суперпользователя.
	--sqlFile=<file> - задает имя файла, в который будет записан SQL скрипт для выполнения. БД изменена не будет.
	--sqlFileEncoding=<encoding> - кодировка для файла с SQL скриптом, по умолчанию используется кодировка UTF-8 	
    --logLevel=<all|finest|finer|fine|info|warning|severe|off> - задает уровень логирования
    --logFile=<file> - задает имя файла для сохранения логов. По умолчанию логи выводятся на консоль.
    -Dmastername=<sys> - имя схемы для MSSQL, необходимо указать если имя отлично от dbo, в базе master(например --mastername=sys)"
    -D<propertyName>=<propertyValue> - задают дополнительные параметры, необходимые для инициализации или обновления БД
    	 
Вместо указания опций скрипта инициализации в командной строке, необходимые опции можно задать в файле dbmanager.properties.
В поставку входит шаблон файла dbmanager.properties.tmp. 
Для его использования переименуйте файл и заполните необходимые свойства. Неиспользуемые строки удалите.

Если одна и та же опция присутствует в комендной строке и в properties файле, то будет использоваться значение из командной строки.

В случае успешной работы скрипта, в конце Вы получите соответствующее сообщение.
Иначе Вы получите сообщение об ошибке.


	Примеры.
	
Создать и проинициализировать базу данных модуля "с нуля", если БД уже существует, удалить ее (Oracle):

	dm.bat -d -c -i --url=jdbc:oracle:thin:@v-oracle:1521:crm --database=example1 --username=example --password=secret  --admin=system --adminPassword=secret

* Обратите внимание, что в Oracle имя пользователя и имя БД есть суть одно и тоже, 
поэтому опция username не имеет силы, программа создаст пользователя с именем заданным опцией database. 

Создать и проинициализировать таблицы данных модуля в базе платформы (Oracle):

	dm.bat -i --url=jdbc:oracle:thin:@v-oracle:1521:platformsoa --database=example1 --username=example --password=secret

Пролить инициализациооные данные модуля в таблицы платформы в базе платформы (Oracle).

	dm.bat -i -p --url=jdbc:oracle:thin:@v-oracle:1521:platformsoa --database=example1 --username=example --password=secret
	
Обновить существующую БД до текущей версии	(MS SQL Server):

	dm.bat -u --url=jdbc:jtds:sqlserver://v-mssql:1433/example;INSTANCE=mssql2005 --username=sa --password=secret 	

* Обратите внимание, что обновление БД MS SQL Server необходимо выполнять под администратором БД, 
иначе будет выдано сообщение об ошибке. 

Обновить данные модуля в таблицах платформы существующей БД до текущей версии	(MS SQL Server):

	dm.bat -u -p --url=jdbc:jtds:sqlserver://v-mssql:1433/example;INSTANCE=mssql2005 --username=sa --password=secret 	 

